<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>BioAthletic | Administração</title>

<link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700;900&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

<style>
:root {
    --primary:#ff3b3b;
    --success:#00e676;
    --bg:#0a0a0a;
    --card:#161616;
    --border:rgba(255,255,255,.06);
    --text:#fff;
}

* { box-sizing:border-box; font-family:Montserrat,sans-serif }
body { margin:0; background:var(--bg); color:var(--text); }

header {
    padding:25px;
    text-align:center;
    background:var(--card);
    border-bottom:2px solid var(--primary);
}
header span { color:var(--primary) }

.container { max-width:1200px; margin:auto; padding:20px }

.filter-bar {
    display:grid;
    grid-template-columns:repeat(auto-fit,minmax(180px,1fr));
    gap:15px;
    background:var(--card);
    padding:20px;
    border-radius:16px;
    border:1px solid var(--border);
    margin-bottom:20px;
}
.filter-bar input, .filter-bar select {
    width:100%;
    padding:12px;
    background:#000;
    border:1px solid #333;
    border-radius:10px;
    color:#fff;
}

.actions {
    display:flex;
    justify-content:space-between;
    align-items:center;
    margin-bottom:15px;
    flex-wrap:wrap;
    gap:10px;
}

.actions button {
    padding:10px 20px;
    border-radius:10px;
    font-weight:800;
    border:none;
    cursor:pointer;
}
.btn-pay { background:var(--success) }
.btn-del { background:transparent; border:1px solid var(--primary); color:var(--primary) }

.table-box {
    background:var(--card);
    border-radius:20px;
    overflow:hidden;
    border:1px solid var(--border);
}

table { width:100%; border-collapse:collapse }
th, td { padding:16px; text-align:left }
th { color:var(--primary); font-size:.7rem; text-transform:uppercase }
tr:not(:last-child) td { border-bottom:1px solid var(--border) }

.status {
    padding:4px 10px;
    border-radius:6px;
    font-size:.65rem;
    font-weight:800;
}
.pago { background:rgba(0,230,118,.15); color:var(--success) }
.pendente { background:rgba(255,59,59,.15); color:var(--primary) }

.circle {
    width:32px; height:32px;
    border-radius:50%;
    display:flex;
    align-items:center;
    justify-content:center;
    cursor:pointer;
    border:none;
}
.circle.pay { background:var(--success) }
.circle.del { background:rgba(255,59,59,.15); color:var(--primary) }

@media(max-width:700px){
    table { font-size:.8rem }
}
</style>
</head>

<body>

<header>
    <h1>BIO<span>ATHLETIC</span> | ADMIN</h1>
</header>

<div class="container">

    <!-- FILTROS -->
    <div class="filter-bar">
        <input id="fNome" placeholder="Nome do aluno" oninput="filtrar()">
        <input id="fValor" type="number" placeholder="Mensalidade" oninput="filtrar()">
        <input id="fMeses" type="number" placeholder="Meses" oninput="filtrar()">
        <select id="fStatus" onchange="filtrar()">
            <option value="">Todos</option>
            <option value="pago">Pago</option>
            <option value="pendente">Pendente</option>
        </select>
    </div>

    <!-- AÇÕES -->
    <div class="actions">
        <div>
            <button class="btn-pay" onclick="acaoLote('pago')">
                <i class="fas fa-check"></i> Marcar Pago
            </button>
            <button class="btn-del" onclick="acaoLote('excluir')">
                <i class="fas fa-trash"></i> Excluir
            </button>
        </div>
        <strong id="stats"></strong>
    </div>

    <!-- TABELA -->
    <div class="table-box">
        <table>
            <thead>
                <tr>
                    <th><input type="checkbox" onclick="toggleAll(this)"></th>
                    <th>Aluno</th>
                    <th>Contato</th>
                    <th>Meses</th>
                    <th>Status</th>
                    <th>Total Devido</th>
                    <th>Ações</th>
                </tr>
            </thead>
            <tbody id="lista"></tbody>
        </table>
    </div>

</div>

<script>
const API = "https://apiphp-production-bce2.up.railway.app";
let DADOS = [];

async function carregar() {
    const r = await fetch(API+"?action=listar_alunos");
    const j = await r.json();
    DADOS = j.data || [];
    render(DADOS);
}
carregar();

function render(lista){
    const tb = document.getElementById("lista");
    tb.innerHTML = "";
    lista.forEach(a=>{
        tb.innerHTML += `
        <tr>
            <td><input type="checkbox" data-cpf="${a.cpf}"></td>
            <td><b>${a.nome}</b><br><small>${a.cpf}</small></td>
            <td>${a.telefone}</td>
            <td>${a.meses_total}</td>
            <td><span class="status ${a.status}">${a.status.toUpperCase()}</span></td>
            <td>R$ ${a.valor_total_devido.toFixed(2)}</td>
            <td>
                ${a.status=="pendente"?
                `<button class="circle pay" onclick="pagar('${a.cpf}')"><i class="fas fa-dollar-sign"></i></button>`:""}
                <button class="circle del" onclick="excluir('${a.cpf}')"><i class="fas fa-trash"></i></button>
            </td>
        </tr>`;
    });
    document.getElementById("stats").innerText = lista.length+" alunos";
}

function filtrar(){
    const n=fNome.value.toLowerCase(),
          v=fValor.value,
          m=fMeses.value,
          s=fStatus.value;
    render(DADOS.filter(a=>
        a.nome.toLowerCase().includes(n) &&
        (!v || a.mensalidade_base==v) &&
        (!m || a.meses_total==m) &&
        (!s || a.status==s)
    ));
}

async function pagar(cpf){
    await fetch(API+"?action=atualizar_status",{method:"POST",body:new FormData(Object.assign(document.createElement("form"),{cpf,novo_status:"pago"}))});
    carregar();
}

async function excluir(cpf){
    if(!confirm("Excluir aluno?"))return;
    await fetch(API+"?action=apagar_aluno",{method:"POST",body:new FormData(Object.assign(document.createElement("form"),{cpf}))});
    carregar();
}

function acaoLote(tipo){
    document.querySelectorAll("tbody input:checked").forEach(cb=>{
        tipo=="pago"?pagar(cb.dataset.cpf):excluir(cb.dataset.cpf);
    });
}

function toggleAll(e){
    document.querySelectorAll("tbody input").forEach(c=>c.checked=e.checked);
}
</script>

</body>
</html>
